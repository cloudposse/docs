{/*
  Getting Started with the Reference Architecture - Slide Content

  This file contains the slide content for the "Getting Started" presentation.
  It can be imported and embedded in other MDX files using:

  import GettingStartedSlides from '@site/docs/slides/_getting-started.mdx';
  <GettingStartedSlides />
*/}

import {
  SlideDeck,
  Slide,
  SlideTitle,
  SlideSubtitle,
  SlideContent,
  SlideList,
  SlideCode,
  SlideImage,
  SlideSplit,
  SlideNotes,
} from '@site/src/components/SlideDeck';

<SlideDeck title="Getting Started with the Reference Architecture">

{/* Slide 1: Title */}
<Slide layout="title">
  <SlideTitle>Getting Started with the Reference Architecture</SlideTitle>
  <SlideSubtitle>The "Big Picture" Overview</SlideSubtitle>
  <SlideNotes>
    Welcome to the introduction to the Cloud Posse toolchain. In this presentation,
    we'll cover the big picture of the Cloud Posse reference architecture.
  </SlideNotes>
</Slide>

{/* Slide 2: Goals */}
<Slide layout="content">
  <SlideTitle>Goals for Today</SlideTitle>
  <SlideList>
    <li>Training Handoff Layout and Schedule</li>
    <li>Terminology</li>
    <li>Conventions</li>
    <li>Repository Layout</li>
    <li>Toolbox</li>
  </SlideList>
  <SlideNotes>
    At this point, you may be wondering, "when can I start to use my infrastructure?"
    And "when will I learn how to develop Components?" Or "How can I get help?"
    We'll answer all these questions and more in this handoff.
    We are going to cover the basics of Cloud Posse's toolchain and the structure of these handoffs,
    including the recommended listening order.
  </SlideNotes>
</Slide>

{/* Slide 3: Handoff Schedule */}
<Slide layout="content">
  <SlideTitle>What to Expect: Training & Handoff Order</SlideTitle>
  <SlideSplit ratio="1:1">
    <SlideList ordered>
      <li>Kick Off</li>
      <li>Introduction to Toolset</li>
      <li>Identity and Authentication</li>
      <li>Component Development</li>
      <li>Account Management</li>
      <li>DNS & Network Architecture</li>
      <li>ECS/EKS Clusters</li>
    </SlideList>
    <SlideList ordered>
      <li>Atmos GitOps Workflows</li>
      <li>Monitoring</li>
      <li>Alerting</li>
      <li>Release Engineering</li>
      <li>Final Call (Sign-off)</li>
    </SlideList>
  </SlideSplit>
  <SlideSubtitle>This schedule is open for customization to best suit your needs</SlideSubtitle>
  <SlideNotes>
    This is the general idea of what to expect in handoffs.
    Each of these topics starts with a brief presentation and should address the most common questions we receive from customers.
    We recommend attending the weekly customer workshops for an open-ended discussion on any of these topics.
    Of course, this schedule depends on the specifics of your engagement.
  </SlideNotes>
</Slide>

{/* Slide 4: Terminology Section Title */}
<Slide layout="title">
  <SlideTitle>Terminology</SlideTitle>
  <SlideNotes>
    So let's begin by covering our terminology.
    Cloud Posse has coined a few terms that we use across our architecture and with Atmos
    to refer to a number of unique practices.
  </SlideNotes>
</Slide>

{/* Slide 5: Stacks */}
<Slide layout="content">
  <SlideTitle>Stacks</SlideTitle>
  <SlideSplit ratio="1:1">
    <SlideList>
      <li>Written as YAML</li>
      <li>Configures Terraform variables and Atmos settings</li>
      <li>Defines Instances of Components</li>
      <li>Found under <code>stacks/</code></li>
    </SlideList>
    <SlideCode language="yaml">
{`components:
  terraform:
    cloudtrail:
      settings:
        github:
          actions_enabled: false
      vars:
        enabled: true
        name: cloudtrail
        cloudtrail_bucket_environment_name: ue2
        cloudtrail_bucket_stage_name: audit
        cloudwatch_logs_retention_in_days: 90
        is_organization_trail: true`}
    </SlideCode>
  </SlideSplit>
  <SlideNotes>
    Stacks are a way to express the complete infrastructure needed for a deployment.
    Think of a Stack like an architectural "Blueprint" composed of one or more Components
    and defined using a standardized YAML configuration.
    This abstraction layer helps orchestrate loosely coupled components, or Terraform root modules.
    They enable scalable infrastructure-as-code configurations that can inherit and deep-merge
    settings to minimize config duplication and manual effort.
    Please note that Cloud Posse's definition of "stacks" is unique and differs from the
    interpretations by HashiCorp, Spacelift, Terragrunt, and others.
  </SlideNotes>
</Slide>

{/* Slide 6: Components */}
<Slide layout="content">
  <SlideTitle>Components</SlideTitle>
  <SlideSplit ratio="1:1">
    <SlideList>
      <li>Reusable building blocks of Infrastructure-as-Code</li>
      <li>Terraform "root" modules</li>
      <li>Details in a follow-up call</li>
    </SlideList>
    <SlideCode language="bash">
{`components/terraform
.
├── account
├── account-map
├── account-settings
├── acm
├── argocd-repo
├── aurora-postgres

─────────────────────────────────────

components/terraform/datadog-monitor
├── README.md
├── component.yaml
├── context.tf
├── main.tf
├── outputs.tf
├── providers.tf
├── variables.tf
└── versions.tf`}
    </SlideCode>
  </SlideSplit>
  <SlideNotes>
    A Terraform root module is a top-level module that specifies a state backend
    and is typically the location where you would run Terraform commands.
    Components are opinionated, self-contained, reusable blocks of Infrastructure-as-Code
    designed to address specific problems or use cases.
    These components are configured within one or more stacks.
    We will thoroughly dive into Components with the Component Development handoff.
  </SlideNotes>
</Slide>

{/* Slide 7: Modules */}
<Slide layout="content">
  <SlideTitle>Modules</SlideTitle>
  <SlideSplit ratio="1:1">
    <SlideList>
      <li>Any Terraform module that is called from another module</li>
      <li>A child module does not have Terraform State</li>
      <li>Called from Components</li>
      <li>Cloud Posse open source modules live in our <a href="https://github.com/cloudposse">GitHub Org</a></li>
    </SlideList>
    <SlideCode language="hcl">
{`module "eks" {
  source  = "cloudposse/stack-config/yaml//modules/remote-state"
  version = "1.3.1"

  component = var.eks_component_name

  context = module.this.context
}`}
    </SlideCode>
  </SlideSplit>
  <SlideNotes>
    A module is a Terraform concept. Technically, they are called child modules,
    but we'll frequently just refer to them as modules.
    Modules are like packages that group multiple resources used together,
    consisting of collections of Terraform files organized within a single source.
    They can call other modules, and unlike terraform root modules or components,
    they don't have state because they don't define provider configuration.
    Cloud Posse maintains an open source collection of modules in our GitHub organization.
  </SlideNotes>
</Slide>

{/* Slide 8: Conventions Section Title */}
<Slide layout="title">
  <SlideTitle>Conventions</SlideTitle>
  <SlideNotes>
    At Cloud Posse, we also have a few conventions that may be outside the industry norm.
    When we refer to the following terms, this is what we mean.
  </SlideNotes>
</Slide>

{/* Slide 9: Environment */}
<Slide layout="content">
  <SlideTitle>Environment</SlideTitle>
  <SlideSplit ratio="1:1">
    <div>
      <SlideList>
        <li>Represents the shorthand notation of the AWS Region where resources are deployed</li>
        <li>Either <strong>short</strong> or <strong>fixed</strong> notation</li>
        <li><code>us-east-1</code> in short is <code>use1</code></li>
        <li><code>us-east-1</code> in fixed is <code>ue1</code></li>
        <li><strong>Fixed</strong> is always 3 letters</li>
        <li><strong>Short</strong> is 3-4 letters typically</li>
      </SlideList>
    </div>
    <SlideCode language="yaml">
{`# Short
region: us-east-1
environment: use1

# Fixed
region: us-east-1
environment: ue1`}
    </SlideCode>
  </SlideSplit>
  <SlideNotes>
    The term "Environment" is frequently overloaded. At Cloud Posse, an Environment is the
    location where resources are deployed. In most cases this is an AWS region.
    Specifically, an environment uses the shorthand notation for a region.
    For example, if the region is US east 1, then the environment is "USE1" or "UE1".
    We use either a "short" or "fixed" notation, but our default recommendation is to use "short" notation.
    Short is easier to understand and is therefore preferred.
  </SlideNotes>
</Slide>

{/* Slide 10: Stage */}
<Slide layout="content">
  <SlideTitle>Stage</SlideTitle>
  <SlideSplit ratio="1:1">
    <div>
      <SlideList>
        <li>A classification for different life cycles in infrastructure management</li>
        <li>In industry, usually referred to as <em>environment</em></li>
        <li>Examples: Dev, Staging, Prod, Auto</li>
        <li>Grouped by <em>tenant</em></li>
      </SlideList>
    </div>
    <SlideCode language="yaml">
{`core: # Tenant (OU)
  artifacts         # Stage
  audit             # Stage
  auto              # Stage
  dns               # Stage
  identity          # Stage
  network           # Stage
  root              # Stage
  security          # Stage
plat: # Tenant (OU)
  dev               # Stage
  staging           # Stage
  prod              # Stage
  sandbox           # Stage`}
    </SlideCode>
  </SlideSplit>
  <SlideNotes>
    A stage at Cloud Posse is a classification for different life cycles in infrastructure management,
    such as the typical Development, Production, Staging, or QA.
    But also stages like "audit" or "security".
    It is recommended to allocate at least one account per stage to maintain clear boundaries and isolation.
    In our industry, the term "Environment" frequently describes what Cloud Posse refers to as "Stage."
    Furthermore, we group these stages by "tenant".
  </SlideNotes>
</Slide>

{/* Slide 11: Tenant */}
<Slide layout="content">
  <SlideTitle>Tenant</SlideTitle>
  <SlideSplit ratio="1:1">
    <div>
      <SlideList>
        <li>A <em>tenant</em> is a logical grouping of stages</li>
        <li>Typically mirrors AWS Organizational Units (OUs)</li>
        <li>We typically have 2: <strong>Core</strong> and <strong>Platform</strong> (plat)</li>
        <li>Can have multiple Platform tenants with the same stages</li>
      </SlideList>
    </div>
    <SlideCode language="yaml">
{`core: # Tenant
  artifacts         # Stage
  audit             # Stage
  auto              # Stage
  dns               # Stage
  identity          # Stage
  network           # Stage
  root              # Stage
  security          # Stage
plat: # Tenant
  dev               # Stage
  staging           # Stage
  prod              # Stage
  sandbox           # Stage`}
    </SlideCode>
  </SlideSplit>
  <SlideNotes>
    A tenant consists of a logical group of stages. By convention, a tenant is almost always 1 to 1
    with an AWS Organizational Unit, also referred to as an "OU".
    With our reference architecture, we deploy 2 tenants: core and platform.
    The core tenant includes all management accounts. These accounts are singletons and will never need to be duplicated.
    The platform or "plat" tenant includes accounts related to your application platform, such as dev, staging, prod.
    You may want to create multiple platform tenants, each with a new set of accounts if you want to isolate a new application platform.
  </SlideNotes>
</Slide>

{/* Slide 12: Repository Layout Section Title */}
<Slide layout="title">
  <SlideTitle>Repository Layout</SlideTitle>
  <SlideNotes>
    Now let's go over the layout of your infrastructure repository itself.
  </SlideNotes>
</Slide>

{/* Slide 13: Documentation */}
<Slide layout="content">
  <SlideTitle>Documentation</SlideTitle>
  <SlideSplit ratio="1:1">
    <div>
      <SlideContent>
        <a href="https://docs.cloudposse.com/">https://docs.cloudposse.com/</a>
      </SlideContent>
      <SlideList>
        <li>Use the README to get started</li>
        <li>ADRs are Architecture Design Records</li>
        <li>Setup docs include how to get started with different layers of architecture</li>
        <li>Component READMEs describe getting started with that individual component</li>
      </SlideList>
    </div>
    <SlideCode language="bash">
{`infrastructure/
├── Makefile
├── README.md
├── components/
│   ├── docker/
│   └── terraform/*/README.md
├── docs/
│   ├── adr/
│   └── setup/
├── rootfs/
└── stacks/`}
    </SlideCode>
  </SlideSplit>
  <SlideNotes>
    We include documentation in a number of places. The latest documentation for everything we do
    at Cloud Posse is at "docs.cloudposse.com".
    The first place to find a high level overview is the README.
    We include all Architecture Design Records or "ADRs" under "docs/adr".
    We also include some setup documentation with specific values used in your organization.
    Finally, we have the READMEs for every component.
  </SlideNotes>
</Slide>

{/* Slide 14: Terraform Configuration */}
<Slide layout="content">
  <SlideTitle>Terraform Configuration</SlideTitle>
  <SlideSplit ratio="1:1">
    <div>
      <SlideList>
        <li><strong>Terraform Configuration:</strong> <code>components/terraform/</code> and <code>stacks/</code></li>
        <li>Components holds Terraform code</li>
        <li>Stacks holds your Organization's configuration for your components</li>
      </SlideList>
    </div>
    <SlideCode language="bash">
{`infrastructure/
├── Makefile
├── README.md
├── components/
│   ├── docker/
│   └── terraform/
├── docs/
├── rootfs/
└── stacks/`}
    </SlideCode>
  </SlideSplit>
  <SlideNotes>
    Configuration for Terraform lives in two places. First, all Terraform code itself lives under
    "components/terraform".
    Each component in this directory is currently pulled from the upstream library of components
    using vendoring, but you can create your own custom components as well.
    The unique configuration for each component in your Organization lives under "stacks".
    This approach ensures a clear separation of configuration from code, maximizing the reusability of components.
  </SlideNotes>
</Slide>

{/* Slide 15: Stack Layout */}
<Slide layout="content">
  <SlideTitle>Stack Layout</SlideTitle>
  <SlideSplit ratio="1:1">
    <SlideList>
      <li><em>catalog</em> defines baseline configurations for components</li>
      <li><em>orgs</em> defines all stacks to deploy</li>
      <li>The <em>orgs</em> file structure mirrors your AWS account structure</li>
      <li>Configurable via <code>atmos.yaml</code></li>
    </SlideList>
    <SlideCode language="bash">
{`infrastructure/stacks/
├── catalog
├── orgs
│   └── acme
│       ├── _defaults.yaml
│       ├── core
│       └── plat
│           ├── _defaults.yaml
│           ├── dev
│           │   ├── _defaults.yaml
│           │   ├── global-region
│           │   │   ├── baseline.yaml
│           │   │   └── identity.yaml
│           │   └── us-east-2
│           │       ├── baseline.yaml
│           │       ├── ecs.yaml
│           │       └── network.yaml
│           ├── prod
│           ├── sandbox
│           └── staging`}
    </SlideCode>
  </SlideSplit>
  <SlideNotes>
    "Stacks" include the account architecture and the catalog of all components.
    The Stack Catalog is used to define a component's default configuration for a specific organization.
    Think of it as where to store the baseline configurations and establish best practices.
    Then import a stack catalog into the stack manifest for a given account.
    By importing the stack catalog into the stack file, you can deploy that component into the account
    and add or override configuration that is unique to this account.
  </SlideNotes>
</Slide>

{/* Slide 16: Toolset Section Title */}
<Slide layout="title">
  <SlideTitle>Toolset</SlideTitle>
  <SlideNotes>
    To get started developing, Cloud Posse has a few tools that we use across all engagements.
  </SlideNotes>
</Slide>

{/* Slide 17: Atmos */}
<Slide layout="content">
  <SlideTitle>Atmos</SlideTitle>
  <SlideList>
    <li><a href="https://atmos.tools/">https://atmos.tools/</a></li>
    <li>Manage environments easily in Terraform</li>
    <li>Simplify complex architectures with DRY configuration</li>
    <li>Is and always will be FREE and Open Source</li>
  </SlideList>
  <SlideNotes>
    We recommend getting started by reviewing the official documentation for Atmos at "atmos.tools".
    However, we will cover Atmos development with the Component Development handoff.
  </SlideNotes>
</Slide>

{/* Slide 18: Atmos Workflows */}
<Slide layout="content">
  <SlideTitle>Atmos Workflows</SlideTitle>
  <SlideSplit ratio="1:1">
    <SlideList>
      <li>Workflows are a way of combining multiple commands into one executable unit of work</li>
      <li>Supports Atmos commands and shell scripting</li>
      <li>Automates running sequences of commands</li>
      <li>Can call other workflows</li>
    </SlideList>
    <SlideCode language="yaml">
{`atmos workflow deploy/eks -s acme-ue1-dev

workflows:
  deploy/eks:
    description: |
      Deploy EKS
    steps:
      - command: terraform deploy vpc
      - command: terraform deploy eks
      - command: terraform deploy \\
                 eks/alb-controller`}
    </SlideCode>
  </SlideSplit>
  <SlideNotes>
    Workflows combine multiple commands into a single executable unit of work,
    which we rely on heavily when deploying the initial infrastructure.
    They are excellent for documenting the steps or process to bring up some infrastructure.
    However, once deployed, usage of workflows may be less common.
    Workflows are entirely optional and have zero impact on your ability to deploy components.
  </SlideNotes>
</Slide>

{/* Slide 19: Atmos Vendoring */}
<Slide layout="content">
  <SlideTitle>Atmos Vendoring</SlideTitle>
  <SlideSplit ratio="1:1">
    <SlideList>
      <li>Allows keeping <strong>Components</strong> up to date with Cloud Posse latest reference architecture</li>
      <li>Vendored in with simple command to pull Terraform files</li>
      <li>Included GitHub Actions can create PRs to keep components up-to-date</li>
    </SlideList>
    <SlideCode language="bash">
{`atmos vendor pull -c foobar

components/terraform/foobar
├── README.md
├── component.yaml
├── context.tf
├── main.tf
├── outputs.tf
├── providers.tf
├── remote-state.tf
├── variables.tf
└── versions.tf`}
    </SlideCode>
  </SlideSplit>
  <SlideNotes>
    Vendoring is what we refer to as the process of pulling in some version of a given component
    from our upstream library of components.
    We reuse the same components across all engagements, thereby ensuring reusability.
    These are free and open source and also shared by the community.
    The "component.yaml" file defines which upstream component and version to pull.
    Separately, we include a GitHub action to regularly open Pull Requests whenever there is a new version available.
  </SlideNotes>
</Slide>

{/* Slide 20: Geodesic */}
<Slide layout="content">
  <SlideTitle>Geodesic</SlideTitle>
  <SlideList>
    <li>Universal DevOps toolbox</li>
    <li><code>make all</code> and <code>make run</code></li>
    <li>Docker Image with pre-installed toolset</li>
    <li>Allows Customization</li>
    <li>Simply an interactive shell</li>
  </SlideList>
  <table style={{width: '80%', margin: '0.5rem auto', borderCollapse: 'collapse', fontSize: '0.75rem'}}>
    <thead>
      <tr style={{background: '#000', color: '#fff'}}>
        <th style={{padding: '0.25rem 0.5rem', border: '1px solid #333'}}>Host</th>
        <th style={{padding: '0.25rem 0.5rem', border: '1px solid #333'}}>Container</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style={{padding: '0.25rem 0.5rem', border: '1px solid #333'}}>~/ ($HOME dir)</td>
        <td style={{padding: '0.25rem 0.5rem', border: '1px solid #333'}}>/localhost/</td>
      </tr>
      <tr>
        <td style={{padding: '0.25rem 0.5rem', border: '1px solid #333'}}>$PROJECT_ROOT/rootfs/</td>
        <td style={{padding: '0.25rem 0.5rem', border: '1px solid #333'}}>/</td>
      </tr>
    </tbody>
  </table>
  <SlideNotes>
    Geodesic is a universal toolbox distributed as a Docker image, and designed to solve the common
    issue of "it works on my machine". When every developer uses Geodesic to plan and apply Terraform,
    every developer has the same tools pre-installed.
    Furthermore, Geodesic allows for customization. You can create unique aliases, commands,
    and startup scripts either for your personal use or across your organization.
  </SlideNotes>
</Slide>

{/* Slide 21: Running Geodesic */}
<Slide layout="content">
  <SlideTitle>Running Geodesic: <code>make all</code></SlideTitle>
  <SlideContent>
    Geodesic is simple to start and run.
  </SlideContent>
  <SlideContent>
    You can build your Geodesic image locally now by cloning the infrastructure repository and running <code>make all</code>.
  </SlideContent>
  <SlideNotes>
    You can build your Geodesic image locally now by cloning the infrastructure repository
    and running "make all". This will build and launch the container with all the tools you need.
  </SlideNotes>
</Slide>

{/* Slide 22: References & Next Steps */}
<Slide layout="content">
  <SlideTitle>References & Next Steps</SlideTitle>
  <SlideSplit ratio="1:1">
    <div>
      <SlideSubtitle>References</SlideSubtitle>
      <SlideList>
        <li>Atmos: <a href="https://atmos.tools/">https://atmos.tools/</a></li>
        <li>Geodesic: <a href="https://github.com/cloudposse/geodesic">github.com/cloudposse/geodesic</a></li>
        <li>Cloud Posse Docs: <a href="https://docs.cloudposse.com">docs.cloudposse.com</a></li>
        <li>Support: <a href="https://docs.cloudposse.com/support/">/support/</a></li>
      </SlideList>
    </div>
    <div>
      <SlideSubtitle>Next Steps</SlideSubtitle>
      <SlideList>
        <li>Build Geodesic locally</li>
        <li>Install Leapp</li>
        <li>Read Identity and Authentication Fundamentals</li>
      </SlideList>
      <SlideSubtitle>Next Call</SlideSubtitle>
      <SlideList>
        <li>Identity and Authentication</li>
      </SlideList>
    </div>
  </SlideSplit>
  <SlideNotes>
    Please take the time to review our documentation at "atmos.tools" and at "docs.cloudposse.com".
    You can now start getting hands on with the code. Try out "make all". Try out some Atmos commands.
    Next time we'll cover "Identity and Authentication".
    As always, please ask us questions in Slack or write them down for the next handoff or community workshop.
  </SlideNotes>
</Slide>

</SlideDeck>
