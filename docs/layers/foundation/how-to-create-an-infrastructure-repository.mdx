---
title: "Creating a Repository"
sidebar_position: 20
---

# How to Create an Infrastructure repository

Create an empty GitHub repository to host infrastructure tools and configuration, and clone it to your host computer into a directory below your `$HOME` directory in the directory tree, for example,`/Users/user/src/infrastructure`. We will refer to the path to this directory as `$REPO_ROOT`.

:::caution
**NOTE**: It is _highly recommended_ to go to the GitHub repository _settings_ > _merge button_ and disable merge and rebase commits. This will force PRs to be squashed and merged into the main branch, which will result in a clean commit history. Otherwise, the git history on the main branch will contain individual commits from each feature branch, which will result in a history which may contain _"dirty"_ commits, i.e. commits from iterative development on the feature branch which has little significance in the main branch's history. Do this is as soon as possible to avoid running into this situation, as squashing commits after the PRs are merged in is not practical on GitHub.

:::

Consult with Cloud Posse about the initial files to add under `$REPO_ROOT`. At a minimum, it needs to have a `Dockerfile` for creating a Docker image based on [Geodesic](/fundamentals/geodesic)  and a `Makefile` for building and running the image.

These files, along with instructions for customizing them, should be in the Cloud Posse `reference-architectures` [GitHub repo](https://github.com/cloudposse/reference-architectures).

You will be using a tool named [Atmos](/fundamentals/atmos)  for most of your work inside Geodesic. This tool orchestrates Terraform workflows and consumes the stack configurations that will be built out in this repository, but before the configuration can be consumed, things such as the default region and the region abbreviation scheme need to be set. Thus at a high level, make sure that the following items are customized from within the Geodesic Dockerfile:

- `ENV DOCKER_IMAGE`: the Docker image name, usually `<company>/infrastructure`, for example `cloudposse/infrastructure`

- `ENV BANNER`: The Geodesic banner message, usually the pretty name of the company, e.g. "Cloud Posse"

- `ENV NAMESPACE`: the project's chosen "namespace"

- `ENV ASSUME_ROLE_INTERACTIVE_QUERY`: should be `"${NAMESPACE}-gbl-"` but we usually hard code it rather than refer to the `$NAMESPACE` variable

- `ENV AWS_PROFILE`: should be `"${NAMESPACE}-gbl-identity"` but we usually hard code it rather than refer to the `$NAMESPACE` variable

- `ENV AWS_REGION_ABBREVIATION_TYPE`: the chosen abbreviation scheme, either `short` or `fixed`

- `ENV AWS_DEFAULT_REGION`: the full name of the chosen default region, e.g. `us-west-2`

- `ENV AWS_DEFAULT_SHORT_REGION`: the chose abbreviation of the default region, e.g. `uw2`

- Terraform version

You will need a `components/terraform` folder that has, at a minimum, Terraform code for the bootstrap components in the following folders under `components/terraform`:

- [account](/components/library/aws/account/)

- [account-map](/components/library/aws/account-map/)

- [account-settings](/components/library/aws/account-settings/)

- [iam-delegated-roles](https://github.com/cloudposse/terraform-aws-components/tree/main/deprecated/iam-delegated-roles)

- [iam-primary-roles](https://github.com/cloudposse/terraform-aws-components/tree/main/deprecated/iam-primary-roles)

- [sso](/components/library/aws/aws-sso/)

- [tfstate-backend](/components/library/aws/tfstate-backend/)

You will also need a `stacks` folder that has a configuration file for each account you want to provision, and also some global configuration files. The name of the files are, by convention, `${environment}-${stage}.yaml`, where `${environment}` is the abbreviation for the AWS region you are using, e.g. `uw2` for `us-west-2`, and `stage` is the name of your account, such as `root`, `identity`, or `prod`. We use the special environment `gbl` for resources that AWS does not limit to a single region, such as IAM Roles.

When first created, the stacks will be missing key information such as:

- Account numbers

- Backend `role_arn` or `profile` to use to access the Terraform backend storage

- Terraform backend configuration files

- (Possibly) SSO SAML provider names and IdP metadata

This information will be missing because it has not been created yet. It will be added in later steps.


