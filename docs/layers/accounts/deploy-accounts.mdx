---
title: "Deploying AWS Accounts"
sidebar_label: "Deploy Accounts"
sidebar_position: 4
description: Deploy AWS accounts with `atmos` workflows and ClickOps.
---
import Intro from '@site/src/components/Intro';
import KeyPoints from '@site/src/components/KeyPoints';
import Steps from '@site/src/components/Steps';
import Step from '@site/src/components/Step';
import StepNumber from '@site/src/components/StepNumber';
import Note from '@site/src/components/Note';
import AtmosWorkflow from '@site/src/components/AtmosWorkflow';
import TaskList from '@site/src/components/TaskList';
import ActionCard from '@site/src/components/ActionCard';
import PrimaryCTA from '@site/src/components/PrimaryCTA';

<Intro>
This step-by-step process outlines how to deploy AWS accounts using `atmos` workflows and ClickOps steps. It covers necessary preparations, such as configuring the AWS Organization, increasing account quotas, and verifying account configurations. The guide details the deployment processes and post-deployment configurations, including setting up account settings, enabling AWS RAM for Organizations, and performing certain manual configurations via ClickOps.
</Intro>

| Steps                     | Actions                                              |
| ------------------------- | ---------------------------------------------------- |
| Deploy AWS Organization   | `atmos workflow deploy/organization -f quickstart/foundation/accounts`     |
| Prepare accounts creation | Click Ops                                            |
| Deploy accounts           | `atmos workflow deploy/accounts -f quickstart/foundation/accounts`         |
| Deploy accounts settings  | `atmos workflow deploy/account-settings -f quickstart/foundation/accounts` |
| Finalize account setup    | Click Ops                                            |

<Steps>
  <Step>
    ## <StepNumber/> Prepare Account Deployment

    Review the "account" configuration in the stack catalog. **This is the hardest part to change/fix once the accounts are
    provisioned**. If you aren't confident about the email configuration, account names, or anything else, now is the time
    to make changes or ask for help.

    You should double-check the following:

    <TaskList>
    - Check that `stacks/catalog/account.yaml` has the values you expect, especially account email format
    - Run `atmos describe component account -s core-gbl-root` to inspect the final component configuration (e.g. _after_
      all the mixins have been imported)
    - Plan the run with `atmos terraform plan account -s core-gbl-root`
    </TaskList>
  </Step>

  <Step>
    ## <StepNumber/> Deploy the AWS Organization

    <AtmosWorkflow workflow="deploy/organization" fileName="quickstart/foundation/accounts" />

  </Step>

  <Step>
    ## <StepNumber/> Confirm the Root Account is configured as an Organization

    The previous step will create the AWS Organization and configure the `core-root` account as the "root" account. Take the time now to verify that the root account is configured as an AWS Organization and that [AWS RAM for Organizations](https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_policies_enable-ram.html) is enabled, which is required for connecting the Organization.

    **Check Organization Status:**

    ```bash
    # Check if AWS Organization exists and get its details
    aws organizations describe-organization

    # Or specifically check if RAM for Organizations is enabled
    aws organizations describe-organization --query 'Organization.FeatureSet'
    ```

    The `FeatureSet` should return `ALL` if RAM for Organizations is enabled, or `CONSOLIDATED_BILLING` if it's not enabled.
  </Step>

  <Step>
    ## <StepNumber/> Raise Account Limits

    If you haven't already completed the Account Quota increase, now is the time to do so. To deploy all accounts, we need to request an increase of the Account Quota from AWS support, which requires an AWS Organization to be created first.

    From the `root` account (not `SuperAdmin`), increase the [account quota to 20+](https://us-east-1.console.aws.amazon.com/servicequotas/home/services/organizations/quotas) for the Cloud Posse reference architecture, or more depending on your business use-case.

    **Alternative: Use AWS CLI**

    You can also use the AWS CLI to request the quota increase:

    ```bash
    aws service-quotas request-service-quota-increase \
      --service-code organizations \
      --quota-code L-E619E033 \
      --desired-value 20
    ```

    Where `L-E619E033` is the quota code for "Default maximum number of accounts" under "AWS Organizations" in "us-east-1".
  </Step>

  <Step>
    ## <StepNumber/> Deploy Accounts

    Again review the "account" configuration in `stacks/catalog/account.yaml`. In particular, check the email address and account names. In the next step, we will create and configure all accounts in the AWS Organization using the configuration in that stack file.

    Once confident, begin the accounts deployment:

    <AtmosWorkflow workflow="deploy/accounts" fileName="quickstart/foundation/accounts" />

    This workflow creates all AWS member accounts in the AWS Organization using the configuration in your stack files.

  </Step>

  <Step>
    ## <StepNumber/> Update Account ID Placeholders

    Now that accounts are created, you have real account IDs to work with. The reference architecture may contain placeholder account IDs (like `111111111111` or `000000000000`) that need to be replaced with your actual values.

    To get your account IDs, run:

    ```bash
    atmos terraform output account -s core-gbl-root
    ## or if on the latest version with instanced components:
    atmos terraform output aws-account/core-artifacts -s core-gbl-root
    ```

    As you continue through the setup process, keep an eye out for placeholder values in your stack configurations and replace them with the actual account IDs as needed.
  </Step>

  <Step>
    ## <StepNumber/> Deploy Accounts Settings

    Once you've created the accounts, you'll need to provision the baseline configuration within the accounts themselves. Run the following:

    <AtmosWorkflow workflow="deploy/account-settings" fileName="quickstart/foundation/accounts" />

    The workflows will kick off several sequential Terraform runs to provision all the AWS member account settings for
    member accounts in the Organization.
  </Step>
 
  <Step>
    ## <StepNumber/> Unsubscribe from Marketing Emails (Optional)

    For each new account, unsubscribe the account's email address from AWS marketing emails:

    <Steps>
    1. Go to [AWS Marketing Preferences](https://pages.awscloud.com/communication-preferences.html)
    1. Click "Unsubscribe from Email"
    1. Enter the account's email address
    1. Check "Unsubscribe from all AWS marketing emails"
    </Steps>

    :::tip Root User Credentials
    With [centralized root access](/layers/identity/centralized-root-access/) enabled, member accounts do not require individual root credentials. If you need per-account root credentials, see [Create Account Root Users](/layers/accounts/tutorials/create-account-root-users/).
    :::
  </Step>
</Steps>

<ActionCard title="Next Steps">
  Now that all accounts are deployed and configured, you're ready to set up CloudTrail for audit logging across your organization.
  <PrimaryCTA to="/layers/accounts/setup-cloudtrail">Setup CloudTrail</PrimaryCTA>
</ActionCard>
