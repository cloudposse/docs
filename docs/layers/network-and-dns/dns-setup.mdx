---
title: "DNS Setup"
sidebar_position: 10
custom_edit_url: https://github.com/cloudposse/refarch-scaffold/blob/main/docs/docs/fundamentals/network-and-dns.md
---

# Setting up DNS

## Service Domains

We recommend deploying a Service Domain in the DNS account and then connecting all app (platform) accounts to this service domain via subdomains.
We delegate a single Host Zone for each account's subdomain. Since DNS is global, multi-resource records or resources in other regions will all be
included in this same zone. This is why we consider the `dns` components as global.
Furthermore, any services added has a logically defined record in the delegated zone.

Consider the diagram below. Here `acme-svc.com` would be deployed with `dns-primary` in the DNS account, and all subdomains would be deployed
in the respective app accounts with `dns-delegated` and use logically defined and hierarchical subdomains. For example,
`echo.use1.dev.plat.acme-svc.com`, `echo.use1.prod.plat.acme-svc.com`, and `echo.use1.auto.core.acme-svc.com`. These domains are logically
creating following the service, region, stage, tenant, and then finally the service domain.

<img src="https://lucid.app/publicSegments/view/ce2727a8-09a3-43d6-8bd9-47222bba7c1e/image.png" style={{width: '100%', minHeight: '480', height: 'auto', margin: '10', position: 'relative'}}/><br/>

_The `echo.use1` resource record (CNAME) is created in the `dev.plat` hosted zone with `dns-delegated`, which is delegated from primary hosted zone, acme-svc.com, in the DNS account with `dns-primary`_

## Vanity Domains

Vanity domains are commonly referred to as "branded" or "marketing" domains and are used to meet the requirements of your individual business.
A business may have any number of vanity domains as required, and that list of domains will grow as your business expands.

Unlike service domains, we do not recommend delegatation on vanity domains. We do not want to share stages for vanity domains, because we must ensure
total isolation between domains in each stage. To do this, we recommend deploying at least one domain per app account. By doing so, we can create
symmetry between prod and non-prod environments and avoid cross-site scripting. This enables properly testing of an apex or root domain, so that
we can fully validate a configuration before deploying to production.

In the diagram below, we have many domains deploy across the organization. The DNS account holds only the root service domain deployed by `dns-primary`.
All other stages control their respective vanity domains with a single `dns-primary` component. For example, we deploy a single vanity domain to dev, `acme-dev.com`,
single vanity domain to staging, `acme-staging.com`, and many vanity domains to production, `acme.com`, `acme-prod.com`, `acme-marketing.com`, or even `alternate-brand.com`.
These domains can be whatever your business requires.

<img src="https://lucid.app/publicSegments/view/2240707a-a123-4c3c-98ba-6fd0d4e7b143/image.png" style={{width: '100%', minHeight: '480', height: 'auto', margin: '10', position: 'relative'}}/><br/>

## Implementation

- [`dns-primary`](/components/library/aws/dns-primary/)
- [`dns-delegated`](/components/library/aws/dns-delegated/)
- [`acm`](/components/library/aws/acm/)