---
title: "Setup DNS"
sidebar_position: 20
---

# Setting up DNS

## Requirements

Before deploying DNS, first purchase the vanity and service domains chosen by ADR
[2001](/reference-architecture/reference/adrs/jumpstart/service-discovery-domain/) and
[2002](/reference-architecture/reference/adrs/jumpstart/decide-on-vanity-domain/)

When registering a new domain, we have the option of using Route53â€™s built-in registrar or using an existing registrar.
Many enterprise-scale organizations use MarkMonitor to manage their domain portfolio. Our convention is to use the `dns`
account as the registrar.

**Note**, the AWS Route53 Registrar cannot be automated with Terraform, so ClickOps is still required for domain
registration.

[Registering domain names using Amazon Route 53 - Amazon Route 53](https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/registrar.html)

We recommend checking with your legal department on where they want to consolidate domain ownership. It has larger
ramifications as to IP/trademark defense.

## Deployment

The DNS stacks are broken up into primary and delegated deployments. Primary DNS zones only start with an `NS` record
among other defaults and expect the the owner of their associated domain to add these `NS` records to whatever console
manages the respective domain. Consult the component's README (`components/terraform/dns-primary/README.md`) for more
information.

The delegated DNS zones insert their `NS` records into the primary DNS zone; thus they are mostly automated. Consult the
component's README `components/terraform/dns-delegated/README.md` for more information.

To start the dns setup, run `atmos workflow deploy/dns -f network`. This will go through creating primaries, and then
follow up with establishing the delegates.

### Adding `NS` records to the Registered Domain (Click Ops)

In order to connect the newly provisioned Hosted Zone to the purchased domains, add the `NS` records to the chosen
Domain Registrar. Retrieve these with the output of `dns-primary`. These will need to be manually added to the
registered domain.

Shared Service Domain, acme-svc.com

```
atmos terraform output dns-primary -s core-gbl-dns
```

Platform Sandbox Vanity Domain, acme-sandbox.com

```
atmos terraform output dns-primary -s plat-gbl-sandbox
```

Platform Dev Vanity Domain, acme-dev.com

```
atmos terraform output dns-primary -s plat-gbl-dev
```

Platform Staging Vanity Domain, acme-stage.com

```
atmos terraform output dns-primary -s plat-gbl-staging
```

Platform Prod Vanity Domain, acme-prod.com

```
atmos terraform output dns-primary -s plat-gbl-prod
```

[For more on `NS` records](https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/SOA-NSrecords.html)

### ACM

Note that each `dns-primary` component will already create its own ACM certs. These are only for the vanity domains and
won't do the more critical service domain certificates.

We use a separate instance of the `acm` component to provision the service domain certificates, which still rely on the
`dns-delegated` component. Setting these up can be done quickly by running `atmos workflow deploy/acm -f network`.
