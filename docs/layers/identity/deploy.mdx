---
title: "Deploy IAM Roles"
sidebar_label: "Deploy IAM Roles"
sidebar_position: 4
description: Deploy IAM roles for GitHub Actions and machine users using the iam-role component.
---
import Intro from '@site/src/components/Intro';
import KeyPoints from '@site/src/components/KeyPoints';
import Steps from '@site/src/components/Steps';
import Step from '@site/src/components/Step';
import StepNumber from '@site/src/components/StepNumber';
import Note from '@site/src/components/Note';
import AtmosWorkflow from '@site/src/components/AtmosWorkflow';

{/* TODO:DEPRECATE-ACCOUNT-MAP - UPDATE PAGE - Status: Done */}

<Intro>
Deploy IAM roles for GitHub Actions and machine users using the `iam-role` component. These roles are assumed via OIDC for CI/CD automation.
</Intro>

<Note title="Legacy Approach">
The legacy `aws-teams` and `aws-team-roles` components are deprecated. This page documents the new approach using Permission Sets for human users and IAM roles for machine users.

For the legacy approach, see [Centralized Terraform Access](/layers/identity/tutorials/centralized-terraform-access/).
</Note>

## Overview

The identity layer provides two authentication paths:

<Steps>
  1. **Human Users** — Use AWS IAM Identity Center Permission Sets (TerraformApplyAccess, TerraformPlanAccess) via SSO
  1. **Machine Users** — Use IAM roles assumed via OIDC (GitHub Actions, CI/CD pipelines)
</Steps>

Human users authenticate through Identity Center and never need IAM roles. The `iam-role` component is specifically for GitHub Actions and other machine users that authenticate via OIDC.

## Deploy IAM Roles for GitHub Actions

<Steps>
  <Step>
    ### <StepNumber/> Vendor Identity Components

    Pull the identity components into your local repository:

    <AtmosWorkflow workflow="vendor" fileName="identity" />
  </Step>

  <Step>
    ### <StepNumber/> Deploy GitHub OIDC Provider

    Deploy the GitHub OIDC provider in all accounts:

    ```bash
    atmos workflow deploy -f github-oidc-provider
    ```

    This creates the OIDC identity provider in each account, allowing GitHub Actions to assume IAM roles.
  </Step>

  <Step>
    ### <StepNumber/> Configure IAM Roles for CI/CD

    The `iam-role` component creates roles that GitHub Actions can assume via OIDC:

    ```yaml
    # stacks/catalog/iam-role/github-actions.yaml
    components:
      terraform:
        iam-role/github-actions-plan:
          vars:
            enabled: true
            role_name: github-actions-plan
            role_description: "IAM role for GitHub Actions plan operations"
            assume_role_policy_statements:
              - effect: "Allow"
                principals:
                  Federated:
                    - "arn:aws:iam::${identity_account_id}:oidc-provider/token.actions.githubusercontent.com"
                actions:
                  - "sts:AssumeRoleWithWebIdentity"
                conditions:
                  StringEquals:
                    "token.actions.githubusercontent.com:aud": "sts.amazonaws.com"
                  StringLike:
                    "token.actions.githubusercontent.com:sub": "repo:your-org/your-repo:*"
    ```
  </Step>

  <Step>
    ### <StepNumber/> Deploy IAM Roles

    Deploy the IAM roles across all accounts:

    <AtmosWorkflow workflow="deploy/identity" fileName="identity" />

    This deploys:

    <Steps>
      1. **GitHub Actions roles** — Roles for CI/CD plan and apply operations
      1. **Trust policies** — Allow assumption via GitHub OIDC
      1. **Permission boundaries** — Enforce least-privilege access
    </Steps>
  </Step>

  <Step>
    ### <StepNumber/> Configure GitHub Actions Workflow

    In your GitHub Actions workflow, assume the role using OIDC:

    ```yaml
    # .github/workflows/terraform.yml
    jobs:
      plan:
        permissions:
          id-token: write
          contents: read
        steps:
          - uses: aws-actions/configure-aws-credentials@v4
            with:
              role-to-assume: arn:aws:iam::123456789012:role/github-actions-plan
              aws-region: us-east-1

          - run: atmos terraform plan vpc -s plat-ue1-dev
    ```
  </Step>
</Steps>

## Human User Access

Human users do **not** use IAM roles. Instead, they authenticate via AWS IAM Identity Center:

<Steps>
  1. **Permission Sets** — Define access levels (TerraformApplyAccess, TerraformPlanAccess, ReadOnlyAccess)
  1. **SSO Groups** — Map IdP groups to Permission Sets
  1. **Atmos Auth** — CLI tool that authenticates via Identity Center SSO
</Steps>

See [Configure Atmos Auth](/layers/identity/atmos-auth/) for human user setup.

## Next Steps

After deploying IAM roles:

<Steps>
  1. **Configure Atmos Auth** — Set up authentication for your team ([Login to AWS](/layers/identity/how-to-log-into-aws/))
  1. **Setup GitHub Actions** — Configure CI/CD workflows ([GitHub Actions](/layers/github-actions/))
  1. **Deploy baseline** — Continue with baseline components ([Deploy Accounts](/layers/accounts/deploy-accounts/))
</Steps>
