import:
  - mixins/region/global-region
  - orgs/acme/_defaults
  - catalog/spacelift/admin-stack
  - catalog/spacelift/spaces

# These intentionally overwrite the default values
vars:
  tenant: root
  environment: gbl
  stage: spacelift

components:
  terraform:
    # This root admin stack creates other admin stacks, spacelift/spaces, and spacelift/worker-pool
    admin-stack:
      metadata:
        component: spacelift/admin-stack
        inherits:
          - admin-stack/default
      settings:
        spacelift:
          root_administrative: true
          labels:
            - root-admin
            - admin
      vars:
        enabled: true
        root_admin_stack: true # This stack will be created in the root space and will create all the other admin stacks as children.
        context_filters: # context_filters determine which child stacks to manage with this admin stack
          administrative: true # This stack is managing all the other admin stacks
          root_administrative: false # We don't want this stack to also find itself in the config and add itself a second time
        labels:
          - admin
        # attachments only on the root stack
        root_stack_policy_attachments:
          - TRIGGER Global Administrator
          - GIT_PUSH Global Administrator # Always trigger this stack on pushes to main
        # this creates policies for the child admin stacks
        child_policy_attachments:
          - TRIGGER Global Administrator
          - GIT_PUSH Global Administrator # Always trigger admin stacks on pushes to main

      # please ignore me...
      # This is a test change for the sake of validating github actions.
      # If all goes well, this comment will be removed shortly
